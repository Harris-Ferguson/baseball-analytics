# Baseball Analytics
&#x1F534; Under Construction - might be ready for use by 12/18/19  

Scripts to download, parse, and prepare baseball data for Pandas analysis.

Additional scripts to optionally load data into Postgres for analysis using SQL.

## Summary

Retrosheet has MLB data for each game.  Lahman has MLB data summed for each year.

For games in the last 50 years or so, the Lahman data is very close to the Retrosheet data summed per year.  Lahman also has some data not available in Retrosheet, such as a player's salary.

The Lahman data is tidy and has several csv files.  The data dictionary, which is the field name to field description mapping for each csv file is in http://www.seanlahman.com/files/database/ and is called readme2017.txt

Retrosheet is not distributed as csv files, but as text files which have play-by-play information.  This data must be parsed to create csv files.  The parsing will be done with open source parsers from Dr. T. L. Turocy described below.  The data dictionary, which maps the field names created by parsers to the field descriptions is somewhat tricky to generate from the parsers.  A script was written to get this information.

As of December 2019, Lahman has data through the 2018 season whereas Retrosheet has data through the 2019 season.

The scripts will allow for data analysis using either Pandas or SQL.  It is not necessary to use both Pandas and SQL.

The field names in both datasets will be slightly changed to:

* ensure that the same attributes in Lahman and Retrosheet, have the same name
* ensure that the names are valid identifiers for Pandas columns and Postgres columns, without requiring the use of quotes
* match as closely as possible to the standard MLB abbreviation.  See: https://en.wikipedia.org/wiki/Baseball_statistics
* use lower case snake case names, as is suggested for Python variables

The scripts were tested using all data for Lahman and the data from 1955 onward for Retrosheet, although the scripts should work fine for all data.  The year 1955 was chosen as this is the year that both the National and American League recorded statistics for sacrifice flies, sacrifice bunts, and intentional walks.

A player can take on the role of a batter, fielder, or pitcher.  For example, the same player could hit a home run as a batter and give up a home run as a pitcher.

A player can take on any of nine fielding roles.  For example, the same player could record a put-out while in the role of second baseman, and later record a put-out while in the role of first baseman.



## Data Sources

### Lahman

Most recent data at: https://github.com/chadwickbureau/baseballdatabank/archive/master.zip

#### Lahman Data Dictionary

Most recent data dictionary is: http://www.seanlahman.com/files/database/readme2017.txt  
This file is copied to this repo at: data/lahman/readme2017.txt

#### CSV Data Files

The csv files for Lahman are tidy.

Provides Aggregated Statistics for:

* **per player per year**
  * Batting.csv
  * Fielding.csv
  * Pitching.csv
* **per team per year**
  * Teams.csv
* **reference tables**
  * People.csv
* and more ...

### Retrosheet

Play by play data per year: http://www.retrosheet.org/events/{year}eve.zip

#### CSV Data Files

The csv files must be generated by parsing the play-by-play event data files.

The **cwdaily** parser generates statistics per player per game.  Attributes are prefixed by b for batter, p for pitcher and f for fielder.

The **cwgame** parser generates statistics per team per game.

The cwgame produced csv file will be made tidy to create 2 csv files:

- game.csv: game attributes (time, attendance, etc.)
- team_game.csv: batting/pitching/fielding attributes per team per game

##### Parsers

Open source project created by Dr. T. L. Turocy.

Parser Description: http://chadwick.sourceforge.net/doc/cwtools.html  
Parser Executables and Source: https://sourceforge.net/projects/chadwick/  

At the time of this writing, version 0.7.2 is the latest version.  Executable versions of the parsers are available for Windows.  Source code is available for Linux and MacOS.

##### How to Build Parsers on Linux

If you do not already have a build environment:

1. sudo apt install gcc
2. sudo apt install build-essential

cd to the source directory:

1. ./configure
2. make
3. sudo make install

Result

1. The cw command line tools will be installed in /usr/local/bin.
2. The cw library will be installed in /usr/local/lib.

To allow the command line tools to find the shared libraries, add the following to your .bashrc and then: source .bashrc
`export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib`

#### Retrosheet Data Dictionary

A Python script was created to generate the data dictionary for the cwdaily parser and the cwgame parser.  The results of running this script are at:  data/retrosheet

* cwdaily_fields.csv
* cwgame_fields.csv
