# Baseball Analytics
<span style="color:red">Under Construction - not ready for use</span>

Scripts to download, parse, and prepare baseball data for Pandas analysis.

Additional scripts to optionally load data into Postgres.

## Data Sources

### Lahman

Most recent data at: https://github.com/chadwickbureau/baseballdatabank/archive/master.zip

#### Lahman Data Dictionary

Most recent data dictionary is: http://www.seanlahman.com/files/database/readme2017.txt  
This file is copied to this repo at: data/lahman/wrangled/readme2017.txt

#### CSV Data Files

The csv files for Lahman are "tidy" to use the Data Science term, or "normalized" to use the database term.

Provides Aggregated Statistics for:

* **per player per year**
  * Batting.csv
  * Fielding.csv
  * Pitching.csv
* **per team per year**
  * Teams.csv
* **reference tables**
  * People.csv
  * Parks.csv
* and more ...

### Retrosheet

Yearly data at: http://www.retrosheet.org/events/{year}eve.zip

The raw data has every play of every game in a non-csv format.

#### CSV Data Files

The csv files must be generated by parsing the play-by-play event data files.

The **cwdaily** parser generates statistics per player per game.

The **cwgame** parser generates statistics per team per game.

The cwdaily produced csv file will be made tidy to create 3 csv files:

- b_player_game.csv: batting attributes per batter per game
- p_player_game.csv: pitching attributes per pitcher per game
- f_player_game.csv: fielding attributes per fielder per game

The cwgame produced csv file will be made tidy to create 2 csv files:

- game.csv: game attributes (time, attendance, etc.)
- team_game.csv: batting/pitching/fielding attributes per team per game

##### Parsers

Open source project created by Dr. T. L. Turocy.

Parser Description: http://chadwick.sourceforge.net/doc/cwtools.html  
Parser Executables and Source: https://sourceforge.net/projects/chadwick/  

At the time of this writing, version 0.7.2 is the latest version.  Executable versions of the parsers are available for Windows.  Source code is available for Linux and MacOS.

##### How to Build Parsers on Linux

If you do not already have a build environment:

1. sudo apt install gcc
2. sudo apt install build-essential

cd to the source directory:

1. ./configure
2. make
3. sudo make install

Result

1. The cw command line tools will be installed in /usr/local/bin.
2. The cw library will be installed in /usr/local/lib.

To allow the command line tools to find the shared libraries, add the following to your .bashrc and then: source .bashrc
`export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib`

#### Retrosheet Data Dictionary

Files at: data/retrosheet/wrangled/

* cwdaily_fields.csv for cwdaily parser
* cwgame_fields.csv for cwgame parser

The Retrosheet Data Dictionary files were created by using a Python script with RegEx to parse the comments in the C source code for the parsers.

